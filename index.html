<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule-I - Recipe guide</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="src/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!---->
    <meta property="og:title" content="Schedule-I : Guide de recettes" />
    <meta property="og:description" content="Il est temps de cuisiner." />
    <meta property="og:image" content="src/logo.png" />
    <meta property="og:url" content="https://ledukilian.github.io/Schedule-I/" />
    <meta property="og:type" content="website" />
    <!---->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Schedule-I : Guide de recettes" />
    <meta name="twitter:description" content="Il est temps de cuisiner." />
    <meta name="twitter:image" content="src/logo.png" />


</head>
<body>
<div class="container">
    <div class="logo-container">
        <img src="src/logo.png" alt="Logo Schedule-I" class="logo">
    </div>
    <h1>
        <!--span class="color-green">Schedule-I :</span>-->Recipe guide
    </h1>
    <section class="tree-view" id="main-tree">
        <!-- La structure sera générée par JavaScript -->
    </section>
    <div class="footer">
        <a href="https://github.com/ledukilian/Schedule-I" target="_blank" class="text-blue-900 hover:text-blue-700">GitHub</a>
        <p class="version"> Version 0.2.0</p>
        <p style="margin-top:5px">Made with ❤️ by <a href="https://github.com/ledukilian" target="_blank" class="text-blue-900 hover:text-blue-700">Kilian LE DU</a></p>
    </div>
</div>
<script>
    // Structure des données
    const initialData = [];

    // Fonction pour créer l'arborescence
    function createTree(data, parentElement, level = 0) {
        // Sort data by "marge" in descending order
        data.sort((a, b) => {
            if (a.marge && b.marge) {
                return parseFloat(b.marge) - parseFloat(a.marge);
            }
            return 0;
        });

        // count children and add count property to each data
        data.forEach(item => {
            if (item.children && item.children.length > 0) {
                item.count = item.children.length;
            } else {
                item.count = 0;
            }
        });

        data.forEach((item, index) => {
            const treeItem = document.createElement('div');
            treeItem.className = `tree-item level-${level}`;

            const treeHeader = document.createElement('div');
            treeHeader.className = 'tree-header';
            if (item.color) {
                treeHeader.style.borderColor = item.color;
            }

            // Si c'est un élément principal (avec name)
            if (item.name) {
                if (item.price) {
                    treeHeader.innerHTML = `
                        <span class="tree-toggle">▶</span>
                        <span class="emoji">${item.name.split(' ')[0]}</span>
                        <span>${item.name.split(' ').slice(1).join(' ')}</span>
                        <span class="count">${item.count} recipes</span>
                    `;
                } else {
                    treeHeader.innerHTML = `
                        <span class="tree-toggle">▶</span>
                        <span>${item.name}</span>
                    `;
                }
            }
            // Si c'est un élément secondaire (avec additif)
            else if (item.additif) {
                treeHeader.innerHTML = `
                    <span class="mobile-margin-b-15">${item.obtenu}</span>
                    <div class="info-inline">
                        <span class="mobile-margin-y-5 margin info-pill">${item.additif.split(' ')[0]} ${item.additif.split(' ').slice(1).join(' ')}</span>
                        <span class="mobile-margin-y-5 info-pill profit">Profit: <strong>${item.marge}</strong></span>
                        <span class="mobile-margin-y-5 info-pill sell">Sell: <strong>${item.vente}</strong></span>
                        <span class="mobile-margin-y-5 info-pill cost">Cost: <strong>${item.coutProd}</strong></span>
                    </div>
                `;
            }
            // Pour les autres niveaux
            else {
                treeHeader.innerHTML = `
                    <span class="tree-toggle">▶</span>
                    <span>${item.name || 'Option'}</span>
                `;
            }

            treeItem.appendChild(treeHeader);

            // Contenu de l'élément (section pliable)
            const treeContent = document.createElement('div');
            treeContent.className = 'tree-content';

            // Ajouter le détail si présent
            if (item.detail) {
                const detailsSection = document.createElement('div');
                detailsSection.className = 'details-section';
                detailsSection.innerHTML = `
                    <div class="details-title">Détails</div>
                    <div>${item.detail}</div>
                `;
                treeContent.appendChild(detailsSection);
            }

            treeItem.appendChild(treeContent);

            // Si l'élément a des enfants, créer récursivement
            if (item.children && item.children.length > 0) {
                createTree(item.children, treeContent, level + 1);
            }

            parentElement.appendChild(treeItem);

            // Ajouter l'événement de clic pour montrer/cacher le contenu
            treeHeader.addEventListener('click', function() {
                treeContent.classList.toggle('active');
                treeHeader.classList.toggle('active');
                const toggle = treeHeader.querySelector('.tree-toggle');
                if (toggle) {
                    if (treeContent.classList.contains('active')) {
                        toggle.textContent = '▼';
                    } else {
                        toggle.textContent = '▶';
                    }
                }
            });

            // Déplier automatiquement le premier élément pour la démo
            /*if (level === 0 && index === 0) {
                setTimeout(() => {
                    treeHeader.click();
                }, 500);
            }*/
        });
    }

    // Fonction pour tenter de charger les données de l'API, sinon utiliser les données initiales
    function loadData() {
        fetch('https://ledukilian.github.io/Schedule-I/data.json')
            .then(response => response.json())
            .then(data => {
                const mainTree = document.getElementById('main-tree');
                mainTree.innerHTML = ''; // Clear any existing content
                createTree(data, mainTree);
            })
            .catch(error => {
                console.log('Utilisation des données initiales:', error);
                const mainTree = document.getElementById('main-tree');
                createTree(initialData, mainTree);
            });
    }

    // Charger les données
    document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>