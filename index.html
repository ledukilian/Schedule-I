<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule-I - Recipe guide</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="src/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!---->
    <meta property="og:title" content="Schedule-I : Guide de recettes" />
    <meta property="og:description" content="Il est temps de cuisiner." />
    <meta property="og:image" content="src/logo.png" />
    <meta property="og:url" content="https://ledukilian.github.io/Schedule-I/" />
    <meta property="og:type" content="website" />
    <!---->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Schedule-I : Guide de recettes" />
    <meta name="twitter:description" content="Il est temps de cuisiner." />
    <meta name="twitter:image" content="src/logo.png" />


</head>
<body>
<div class="container">
    <div class="logo-container">
        <img src="src/logo.png" alt="Logo Schedule-I" class="logo">
    </div>
    <h1>
        <!--span class="color-green">Schedule-I :</span>-->Recipe guide
    </h1>

    <div class="tabs">
        <button class="tab-button active" data-tab="recipes">Recipes</button>
        <button class="tab-button" data-tab="effects">Effects</button>
        <button class="tab-button" data-tab="calculator">Calculator</button>
    </div>

    <!-- Recipes -->
    <section class="tree-view tab-content" id="recipes-content">

    </section>

    <!-- Effects -->
    <section class="tree-view tab-content" id="effects-content" style="display:none;">
        <table>
            <thead>
            <tr>
                <th>Name</th>
                <th>Multiplier</th>
                <th>Type</th>
                <th class="text-left">Effect</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </section>

    <!-- Calculator -->
    <section class="tree-view tab-content" id="calculator-content" style="display:none;">
        üöß Soon
    </section>

    <div class="footer">
        <a href="https://github.com/ledukilian/Schedule-I" target="_blank" class="text-blue-900 hover:text-blue-700">GitHub</a>
        <p class="version"> Version 0.3.1</p>
        <p style="margin-top:5px">Made with ‚ù§Ô∏è by <a href="https://github.com/ledukilian" target="_blank" class="text-blue-900 hover:text-blue-700">Kilian LE DU</a></p>
    </div>
</div>
<script>
    // Structure des donn√©es
    const initialData = [];
    let recipesData = [];
    let effectsData = [];

    // Fonction pour cr√©er l'arborescence
    function createTree(data, parentElement, level = 0, isFirstLevel = true) {
        // Sort data by "marge" in descending order
        data.sort((a, b) => {
            if (a.marge && b.marge) {
                return parseFloat(b.marge) - parseFloat(a.marge);
            }
            return 0;
        });

        // count children and add count property to each data
        data.forEach(item => {
            if (item.children && item.children.length > 0) {
                item.count = item.children.length;
            } else {
                item.count = 0;
            }
        });

        data.forEach((item, index) => {
            const treeItem = document.createElement('div');
            treeItem.className = `tree-item level-${level}`;

            const treeHeader = document.createElement('div');
            treeHeader.className = 'tree-header';
            if (item.color) {
                treeHeader.style.borderColor = item.color;
            }

            // Si c'est un √©l√©ment principal (avec name)
            if (item.name) {
                if (item.price) {
                    treeHeader.innerHTML = `
                        <span class="tree-toggle">‚ñ∂</span>
                        <span class="emoji">${item.name.split(' ')[0]}</span>
                        <span>${item.name.split(' ').slice(1).join(' ')}</span>
                        <span class="count">${item.count} recipes</span>
                    `;
                } else {
                    treeHeader.innerHTML = `
                        <span class="tree-toggle">‚ñ∂</span>
                        <span>${item.name}</span>
                    `;
                }
            }
            // Si c'est un √©l√©ment secondaire (avec additif)
            else if (item.additif) {
                treeHeader.innerHTML = `
                    <span class="mobile-margin-b-15">${item.obtenu}</span>
                    <div class="info-inline">
                        <span class="info-pill margin">${item.additif.split(' ')[0]} ${item.additif.split(' ').slice(1).join(' ')}</span>
                        <span class="info-pill profit">Profit: <strong>${item.marge}</strong></span>
                        <span class="info-pill sell">Sell: <strong>${item.vente}</strong></span>
                        <span class="info-pill cost">Cost: <strong>${item.coutProd}</strong></span>
                    </div>
                `;
            }
            // Pour les autres niveaux
            else {
                treeHeader.innerHTML = `
                    <span class="tree-toggle">‚ñ∂</span>
                    <span>${item.name || 'Option'}</span>
                `;
            }

            treeItem.appendChild(treeHeader);

            // Contenu de l'√©l√©ment (section pliable)
            const treeContent = document.createElement('div');
            treeContent.className = 'tree-content';

            // Ajouter le d√©tail si pr√©sent
            if (item.detail) {
                const detailsSection = document.createElement('div');
                detailsSection.className = 'details-section';
                detailsSection.innerHTML = `
                    <div class="details-title">D√©tails</div>
                    <div>${item.detail}</div>
                `;
                treeContent.appendChild(detailsSection);
            }

            treeItem.appendChild(treeContent);

            // Si l'√©l√©ment a des enfants, cr√©er r√©cursivement
            if (item.children && item.children.length > 0) {
                // Pour le premier niveau, cr√©er des enfants avec la fonctionnalit√© d√©pliante
                // Pour les niveaux suivants, simplement afficher le contenu sans pliage
                if (isFirstLevel) {
                    createTree(item.children, treeContent, level + 1, false);
                } else {
                    // Pour les niveaux non-premier, afficher directement sans pliage
                    item.children.forEach(child => {
                        const childItem = document.createElement('div');
                        childItem.className = `tree-item level-${level + 1} no-toggle`;

                        if (child.additif) {
                            childItem.innerHTML = `
                                <div class="tree-header">
                                    <span class="mobile-margin-b-15">${child.obtenu}</span>
                                    <div class="info-inline">
                                        <span class="info-pill margin">${child.additif.split(' ')[0]} ${child.additif.split(' ').slice(1).join(' ')}</span>
                                        <span class="info-pill profit">Profit: <strong>${child.marge}</strong></span>
                                        <span class="info-pill sell">Sell: <strong>${child.vente}</strong></span>
                                        <span class="info-pill cost">Cost: <strong>${child.coutProd}</strong></span>
                                    </div>
                                </div>
                            `;
                        } else {
                            childItem.innerHTML = `
                                <div class="tree-header">
                                    <span>${child.name || 'Option'}</span>
                                </div>
                            `;
                        }

                        // Si l'enfant a un d√©tail, l'ajouter directement
                        if (child.detail) {
                            const detailSection = document.createElement('div');
                            detailSection.className = 'details-section';
                            detailSection.innerHTML = `
                                <div class="details-title">D√©tails</div>
                                <div>${child.detail}</div>
                            `;
                            childItem.appendChild(detailSection);
                        }

                        treeContent.appendChild(childItem);
                    });
                }
            }

            parentElement.appendChild(treeItem);

            // Ajouter l'√©v√©nement de clic pour montrer/cacher le contenu,
            // mais seulement pour le premier niveau
            if (isFirstLevel) {
                treeHeader.addEventListener('click', function() {
                    treeContent.classList.toggle('active');
                    treeHeader.classList.toggle('active');
                    const toggle = treeHeader.querySelector('.tree-toggle');
                    if (toggle) {
                        if (treeContent.classList.contains('active')) {
                            toggle.textContent = '‚ñº';
                        } else {
                            toggle.textContent = '‚ñ∂';
                        }
                    }
                });
            }
        });
    }

    // Fonction pour tenter de charger les donn√©es de l'API, sinon utiliser les donn√©es initiales
    function loadData() {
        fetch('https://ledukilian.github.io/Schedule-I/recipes.json')
            .then(response => response.json())
            .then(data => {
                // S√©parez vos donn√©es en deux cat√©gories si n√©cessaire
                recipesData = data.filter(item => item.type === 'recipe' || !item.type);
                effectsData = data.filter(item => item.type === 'effect');

                // Si vous n'avez pas de propri√©t√© type, utilisez toutes les donn√©es pour les recettes
                if (recipesData.length === 0) recipesData = data;

                const recipesContent = document.getElementById('recipes-content');
                recipesContent.innerHTML = ''; // Clear any existing content
                createTree(recipesData, recipesContent);

                if (effectsData.length > 0) {
                    const effectsContent = document.getElementById('effects-content');
                    effectsContent.innerHTML = ''; // Clear any existing content
                    createTree(effectsData, effectsContent);
                }
            })
            .catch(error => {
                console.log('Utilisation des donn√©es initiales:', error);
                const recipesContent = document.getElementById('recipes-content');
                createTree(initialData, recipesContent);
            });

        fetch('https://ledukilian.github.io/Schedule-I/effects.json')
            .then(response => response.json())
            .then(data => {
                effectsData = data;

                const effectsContent = document.getElementById('effects-content').querySelector('tbody');
                effectsContent.innerHTML = '';
                effectsData.forEach(effect => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td style="color: ${effect.color};">${effect.name}</td>
                    <td>${effect.multiplier}</td>
                    <td>${effect.type || ''}</td>
                    <td class="text-left">${effect.description || ''}</td>
                `;
                    effectsContent.appendChild(row);
                });
            })
            .catch(error => {
                console.log('Erreur lors du chargement des effets:', error);
            });
    }

    // Gestion des onglets
    document.addEventListener('DOMContentLoaded', function() {
        loadData();

        // Gestion des onglets
        const tabButtons = document.querySelectorAll('.tab-button');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // R√©initialiser tous les boutons et contenus
                tabButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });

                // Activer l'onglet s√©lectionn√©
                this.classList.add('active');
                const tabName = this.getAttribute('data-tab');
                document.getElementById(`${tabName}-content`).style.display = 'block';
            });
        });
    });
</script>
</body>
</html>